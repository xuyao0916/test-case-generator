# 测试用例生成器部署说明

## 当前状态：局域网访问已配置

### 访问地址
- **前端地址**：http://172.16.85.172:8080/
- **后端API**：http://172.16.85.172:3001/

### 局域网访问配置完成
✅ 后端服务器已配置监听所有网络接口 (`0.0.0.0:3001`)
✅ 前端开发服务器已配置监听所有网络接口 (`0.0.0.0:8080`)
✅ 获取到本机IP地址：`172.16.85.172`

### 其他人如何访问
1. 确保所有设备在同一局域网内
2. 访问地址：http://172.16.85.172:8080/
3. 如果无法访问，请检查防火墙设置

### 防火墙配置（macOS）
1. 打开"系统偏好设置" > "安全性与隐私" > "防火墙"
2. 点击"防火墙选项"
3. 添加应用程序：Node.js
4. 设置为"允许传入连接"

## 后续云服务器部署方案

### 1. 服务器准备
```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 安装PM2进程管理器
sudo npm install -g pm2

# 安装Nginx（可选，用于反向代理）
sudo apt install nginx -y
```

### 2. 代码部署
```bash
# 上传代码到服务器
scp -r test-case-generator user@your-server-ip:/home/user/

# 或使用git
git clone your-repository-url
cd test-case-generator
```

### 3. 安装依赖
```bash
# 安装后端依赖
npm install

# 构建前端
cd client
npm install
npm run build
cd ..
```

### 4. 环境配置
```bash
# 复制环境变量文件
cp .env.example .env

# 编辑环境变量
nano .env
```

### 5. 启动服务
```bash
# 使用PM2启动后端服务
pm2 start server.js --name "test-case-generator"

# 设置开机自启
pm2 startup
pm2 save
```

### 6. Nginx配置（可选）
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # 前端静态文件
    location / {
        root /home/user/test-case-generator/client/dist;
        try_files $uri $uri/ /index.html;
    }
    
    # 后端API代理
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 7. SSL证书配置（推荐）
```bash
# 安装Certbot
sudo apt install certbot python3-certbot-nginx -y

# 获取SSL证书
sudo certbot --nginx -d your-domain.com
```

### 8. 监控和维护
```bash
# 查看PM2状态
pm2 status
pm2 logs

# 重启服务
pm2 restart test-case-generator

# 更新代码后重启
git pull
npm install
cd client && npm run build && cd ..
pm2 restart test-case-generator
```

## Docker部署方案（可选）

### Dockerfile
```dockerfile
FROM node:18-alpine

WORKDIR /app

# 复制package.json
COPY package*.json ./
RUN npm install

# 复制源代码
COPY . .

# 构建前端
WORKDIR /app/client
RUN npm install && npm run build

# 回到根目录
WORKDIR /app

# 暴露端口
EXPOSE 3001

# 启动命令
CMD ["node", "server.js"]
```

### docker-compose.yml
```yaml
version: '3.8'
services:
  test-case-generator:
    build: .
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
    volumes:
      - ./generated:/app/generated
      - ./uploads:/app/uploads
    restart: unless-stopped
```

## 安全建议

1. **API密钥安全**：确保`.env`文件不被提交到版本控制
2. **防火墙配置**：只开放必要的端口（80, 443, 22）
3. **定期更新**：保持系统和依赖包的更新
4. **备份策略**：定期备份生成的文件和配置
5. **监控日志**：设置日志监控和告警

## 故障排除

### 常见问题
1. **端口被占用**：使用`lsof -i :3001`检查端口占用
2. **权限问题**：确保用户有读写权限
3. **内存不足**：监控服务器资源使用情况
4. **API调用失败**：检查DeepSeek API密钥和网络连接

### 日志查看
```bash
# PM2日志
pm2 logs test-case-generator

# Nginx日志
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# 系统日志
journalctl -u nginx -f
```