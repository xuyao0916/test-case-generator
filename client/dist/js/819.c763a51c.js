"use strict";(self["webpackChunktest_case_generator_client"]=self["webpackChunktest_case_generator_client"]||[]).push([[819],{7819:function(e,t,s){s.r(t),s.d(t,{default:function(){return T}});var l=s(641),n=s(33);const a={class:"requirement-review"},i={class:"review-content"},o={class:"api-selection"},r={class:"upload-section"},d={class:"text-input-section"},c={class:"action-section"},u={key:0,class:"result-section"},p={class:"result-header"},v={class:"result-actions"},g={class:"result-content"},w={class:"review-summary"},m={class:"summary-stats"},k={class:"review-details"},h=["innerHTML"],f={key:0,class:"review-suggestions"},b=["innerHTML"];function _(e,t,s,_,y,F){const x=(0,l.g2)("el-radio"),L=(0,l.g2)("el-radio-group"),C=(0,l.g2)("upload-filled"),R=(0,l.g2)("el-icon"),T=(0,l.g2)("el-upload"),U=(0,l.g2)("el-input"),I=(0,l.g2)("Magic"),A=(0,l.g2)("el-button"),M=(0,l.g2)("Download"),W=(0,l.g2)("DocumentCopy"),D=(0,l.g2)("el-tag"),N=(0,l.g2)("el-card");return(0,l.uX)(),(0,l.CE)("div",a,[(0,l.bF)(N,{class:"main-card"},{header:(0,l.k6)(()=>t[2]||(t[2]=[(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("h2",null,"需求评审"),(0,l.Lk)("p",null,"上传需求文档，AI将为您提供专业的需求评审报告")],-1)])),default:(0,l.k6)(()=>[(0,l.Lk)("div",i,[(0,l.Lk)("div",o,[t[5]||(t[5]=(0,l.Lk)("h3",null,"选择AI模型",-1)),(0,l.bF)(L,{modelValue:y.selectedApi,"onUpdate:modelValue":t[0]||(t[0]=e=>y.selectedApi=e),class:"api-options"},{default:(0,l.k6)(()=>[(0,l.bF)(x,{label:"cybotstar"},{default:(0,l.k6)(()=>t[3]||(t[3]=[(0,l.eW)("CybotStar",-1)])),_:1,__:[3]}),(0,l.bF)(x,{label:"deepseek"},{default:(0,l.k6)(()=>t[4]||(t[4]=[(0,l.eW)("deepseek",-1)])),_:1,__:[4]})]),_:1},8,["modelValue"])]),(0,l.Lk)("div",r,[t[8]||(t[8]=(0,l.Lk)("h3",null,"上传需求文档",-1)),(0,l.bF)(T,{ref:"uploadRef",class:"upload-demo",drag:"","auto-upload":!1,"on-change":F.handleFileChange,"on-remove":F.handleFileRemove,"file-list":y.fileList,accept:".txt,.md,.docx,.doc,.pdf,.xlsx,.xls,.json,.xml,.csv",limit:10,multiple:""},{tip:(0,l.k6)(()=>t[6]||(t[6]=[(0,l.Lk)("div",{class:"el-upload__tip"}," 支持格式：.txt, .md, .docx, .doc, .pdf, .xlsx, .xls, .json, .xml, .csv（最大10MB，最多10个文件） ",-1)])),default:(0,l.k6)(()=>[(0,l.bF)(R,{class:"el-icon--upload"},{default:(0,l.k6)(()=>[(0,l.bF)(C)]),_:1}),t[7]||(t[7]=(0,l.Lk)("div",{class:"el-upload__text"},[(0,l.eW)(" 将需求文档拖到此处，或"),(0,l.Lk)("em",null,"点击上传")],-1))]),_:1,__:[7]},8,["on-change","on-remove","file-list"])]),(0,l.Lk)("div",d,[t[9]||(t[9]=(0,l.Lk)("h3",null,"或直接输入需求内容",-1)),(0,l.bF)(U,{modelValue:y.textInput,"onUpdate:modelValue":t[1]||(t[1]=e=>y.textInput=e),type:"textarea",rows:8,placeholder:"请在此输入需求内容，支持Markdown格式...",class:"text-input-textarea",maxlength:"10000","show-word-limit":""},null,8,["modelValue"])]),(0,l.Lk)("div",c,[(0,l.bF)(A,{type:"primary",size:"large",loading:y.reviewing,onClick:F.startReview,disabled:0===y.uploadedFiles.length&&!y.textInput.trim(),class:"review-btn"},{default:(0,l.k6)(()=>[y.reviewing?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(R,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(I)]),_:1})),(0,l.eW)(" "+(0,n.v_)(y.reviewing?"评审中...":"开始需求评审"),1)]),_:1},8,["loading","onClick","disabled"])]),y.reviewResult?((0,l.uX)(),(0,l.CE)("div",u,[(0,l.Lk)("div",p,[t[12]||(t[12]=(0,l.Lk)("h3",null,"需求评审报告",-1)),(0,l.Lk)("div",v,[(0,l.bF)(A,{type:"success",onClick:F.downloadResult,disabled:!y.downloadUrl},{default:(0,l.k6)(()=>[(0,l.bF)(R,null,{default:(0,l.k6)(()=>[(0,l.bF)(M)]),_:1}),t[10]||(t[10]=(0,l.eW)(" 下载报告 ",-1))]),_:1,__:[10]},8,["onClick","disabled"]),(0,l.bF)(A,{onClick:F.copyToClipboard},{default:(0,l.k6)(()=>[(0,l.bF)(R,null,{default:(0,l.k6)(()=>[(0,l.bF)(W)]),_:1}),t[11]||(t[11]=(0,l.eW)(" 复制内容 ",-1))]),_:1,__:[11]},8,["onClick"])])]),(0,l.Lk)("div",g,[(0,l.Lk)("div",w,[t[13]||(t[13]=(0,l.Lk)("h4",null,"评审摘要",-1)),(0,l.Lk)("div",m,[(0,l.bF)(D,{type:F.getScoreType(y.reviewResult.score),size:"large"},{default:(0,l.k6)(()=>[(0,l.eW)(" 综合评分: "+(0,n.v_)(y.reviewResult.score)+"/100 ",1)]),_:1},8,["type"]),(0,l.bF)(D,{type:F.getIssueTagType(y.reviewResult.issueCount),size:"large"},{default:(0,l.k6)(()=>[(0,l.eW)(" 发现问题: "+(0,n.v_)(y.reviewResult.issueCount)+"个 ",1)]),_:1},8,["type"])])]),(0,l.Lk)("div",k,[t[14]||(t[14]=(0,l.Lk)("h4",null,"详细评审内容",-1)),(0,l.Lk)("div",{class:"review-content-text",innerHTML:F.formatReviewContent(y.reviewResult.content)},null,8,h)]),y.reviewResult.suggestions?((0,l.uX)(),(0,l.CE)("div",f,[t[15]||(t[15]=(0,l.Lk)("h4",null,"改进建议",-1)),(0,l.Lk)("div",{class:"suggestions-content",innerHTML:F.formatSuggestions(y.reviewResult.suggestions)},null,8,b)])):(0,l.Q3)("",!0)])])):(0,l.Q3)("",!0)])]),_:1})])}var y=s(4335),F=s(163),x=s(8548),L={name:"RequirementReview",components:{UploadFilled:x.UploadFilled,Magic:x.Magic,Download:x.Download,DocumentCopy:x.DocumentCopy},data(){return{selectedApi:"cybotstar",uploadedFiles:[],fileList:[],fileContents:[],activeFileNames:[],textInput:"",reviewing:!1,reviewResult:null,downloadUrl:""}},methods:{handleFileChange(e){const t=e.size/1024/1024<10;if(!t)return F.nk.error("文件大小不能超过 10MB!"),!1;const s=[".txt",".md",".docx",".doc",".pdf",".xlsx",".xls",".json",".xml",".csv"],l=e.name.toLowerCase(),n=s.some(e=>l.endsWith(e));if(!n)return F.nk.error("不支持的文件格式！"),!1;this.uploadedFiles.push(e.raw);const a=new FileReader;a.onload=t=>{const s={fileName:e.name,content:t.target.result};this.fileContents.push(s),this.activeFileNames.includes(e.name)||this.activeFileNames.push(e.name)},a.readAsText(e.raw),F.nk.success("文件上传成功！")},handleFileRemove(e){const t=this.uploadedFiles.findIndex(t=>t.name===e.name);t>-1&&this.uploadedFiles.splice(t,1);const s=this.fileContents.findIndex(t=>t.fileName===e.name);s>-1&&this.fileContents.splice(s,1);const l=this.activeFileNames.indexOf(e.name);l>-1&&this.activeFileNames.splice(l,1)},async startReview(){if(0!==this.uploadedFiles.length||this.textInput.trim()){this.reviewing=!0;try{const e=new FormData;this.uploadedFiles.forEach(t=>{e.append("files",t)}),this.textInput.trim()&&e.append("content",this.textInput.trim()),e.append("apiProvider",this.selectedApi),e.append("reviewType","requirement");const t=await y.A.post("/api/review/requirement",e,{headers:{"Content-Type":"multipart/form-data"}});if(!t.data.success)throw new Error(t.data.error||"评审失败");this.reviewResult=t.data.result,this.downloadUrl=t.data.downloadUrl,F.nk.success("需求评审完成！")}catch(e){console.error("评审失败:",e);const t=e.response?.data?.error||e.message||"需求评审失败，请稍后重试";F.nk.error(t),this.reviewResult=null,this.downloadUrl=""}finally{this.reviewing=!1}}else F.nk.warning("请上传需求文档或输入需求内容")},async downloadResult(){if(this.downloadUrl)try{const e=await y.A.get(this.downloadUrl,{responseType:"blob"}),t=new Blob([e.data],{type:"application/octet-stream"}),s=window.URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.download=`requirement-review-${(new Date).getTime()}.pdf`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(s),F.nk.success("文件下载成功！")}catch(e){console.error("下载失败:",e),F.nk.error("文件下载失败")}else F.nk.warning("暂无可下载的文件")},async copyToClipboard(){if(this.reviewResult)try{const e=this.reviewResult.content+"\n\n"+(this.reviewResult.suggestions||"");await navigator.clipboard.writeText(e),F.nk.success("评审报告已复制到剪贴板")}catch(e){F.nk.error("复制失败，请手动复制")}},getScoreType(e){return e>=90?"success":e>=70?"warning":"danger"},getIssueTagType(e){return 0===e?"success":e<=3?"warning":"danger"},formatReviewContent(e){return e?e.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"):""},formatSuggestions(e){return e?e.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"):""}}},C=s(6262);const R=(0,C.A)(L,[["render",_],["__scopeId","data-v-6d30c1bd"]]);var T=R}}]);
//# sourceMappingURL=819.c763a51c.js.map