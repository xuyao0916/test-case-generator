"use strict";(self["webpackChunktest_case_generator_client"]=self["webpackChunktest_case_generator_client"]||[]).push([[979],{8979:function(e,t,l){l.r(t),l.d(t,{default:function(){return I}});var s=l(641),n=l(33);const a={class:"requirement-review"},i={class:"review-content"},o={class:"api-selection"},r={class:"upload-section"},d={class:"text-input-section"},c={key:0,class:"file-contents-preview"},u={class:"action-section"},p={key:1,class:"result-section"},v={class:"result-header"},m={class:"result-actions"},g={class:"result-content"},w={class:"review-summary"},k={class:"summary-stats"},h={class:"review-details"},f=["innerHTML"],b={key:0,class:"review-suggestions"},F=["innerHTML"];function y(e,t,l,y,_,x){const L=(0,s.g2)("el-radio"),C=(0,s.g2)("el-radio-group"),R=(0,s.g2)("upload-filled"),T=(0,s.g2)("el-icon"),I=(0,s.g2)("el-upload"),U=(0,s.g2)("el-input"),A=(0,s.g2)("el-collapse-item"),N=(0,s.g2)("el-collapse"),W=(0,s.g2)("Magic"),M=(0,s.g2)("el-button"),V=(0,s.g2)("Download"),D=(0,s.g2)("DocumentCopy"),E=(0,s.g2)("el-tag"),X=(0,s.g2)("el-card");return(0,s.uX)(),(0,s.CE)("div",a,[(0,s.bF)(X,{class:"main-card"},{header:(0,s.k6)(()=>t[3]||(t[3]=[(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("h2",null,"需求评审"),(0,s.Lk)("p",null,"上传需求文档，AI将为您提供专业的需求评审报告")],-1)])),default:(0,s.k6)(()=>[(0,s.Lk)("div",i,[(0,s.Lk)("div",o,[t[6]||(t[6]=(0,s.Lk)("h3",null,"选择AI模型",-1)),(0,s.bF)(C,{modelValue:_.selectedApi,"onUpdate:modelValue":t[0]||(t[0]=e=>_.selectedApi=e),class:"api-options"},{default:(0,s.k6)(()=>[(0,s.bF)(L,{label:"cybotstar"},{default:(0,s.k6)(()=>t[4]||(t[4]=[(0,s.eW)("CybotStar",-1)])),_:1,__:[4]}),(0,s.bF)(L,{label:"openai"},{default:(0,s.k6)(()=>t[5]||(t[5]=[(0,s.eW)("OpenAI",-1)])),_:1,__:[5]})]),_:1},8,["modelValue"])]),(0,s.Lk)("div",r,[t[9]||(t[9]=(0,s.Lk)("h3",null,"上传需求文档",-1)),(0,s.bF)(I,{ref:"uploadRef",class:"upload-demo",drag:"","auto-upload":!1,"on-change":x.handleFileChange,"on-remove":x.handleFileRemove,"file-list":_.fileList,accept:".txt,.md,.docx,.doc,.pdf,.xlsx,.xls,.json,.xml,.csv",limit:10,multiple:""},{tip:(0,s.k6)(()=>t[7]||(t[7]=[(0,s.Lk)("div",{class:"el-upload__tip"}," 支持格式：.txt, .md, .docx, .doc, .pdf, .xlsx, .xls, .json, .xml, .csv（最大10MB，最多10个文件） ",-1)])),default:(0,s.k6)(()=>[(0,s.bF)(T,{class:"el-icon--upload"},{default:(0,s.k6)(()=>[(0,s.bF)(R)]),_:1}),t[8]||(t[8]=(0,s.Lk)("div",{class:"el-upload__text"},[(0,s.eW)(" 将需求文档拖到此处，或"),(0,s.Lk)("em",null,"点击上传")],-1))]),_:1,__:[8]},8,["on-change","on-remove","file-list"])]),(0,s.Lk)("div",d,[t[10]||(t[10]=(0,s.Lk)("h3",null,"或直接输入需求内容",-1)),(0,s.bF)(U,{modelValue:_.textInput,"onUpdate:modelValue":t[1]||(t[1]=e=>_.textInput=e),type:"textarea",rows:8,placeholder:"请在此输入需求内容，支持Markdown格式...",class:"text-input-textarea",maxlength:"10000","show-word-limit":""},null,8,["modelValue"])]),_.fileContents.length>0?((0,s.uX)(),(0,s.CE)("div",c,[t[11]||(t[11]=(0,s.Lk)("h3",null,"文件内容预览",-1)),(0,s.bF)(N,{modelValue:_.activeFileNames,"onUpdate:modelValue":t[2]||(t[2]=e=>_.activeFileNames=e)},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(_.fileContents,(e,t)=>((0,s.uX)(),(0,s.Wv)(A,{key:t,title:e.fileName,name:e.fileName},{default:(0,s.k6)(()=>[(0,s.bF)(U,{value:e.content,type:"textarea",rows:8,placeholder:"文件内容将在这里显示...",readonly:"",class:"file-content-textarea"},null,8,["value"])]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"])])):(0,s.Q3)("",!0),(0,s.Lk)("div",u,[(0,s.bF)(M,{type:"primary",size:"large",loading:_.reviewing,onClick:x.startReview,disabled:0===_.uploadedFiles.length&&!_.textInput.trim(),class:"review-btn"},{default:(0,s.k6)(()=>[_.reviewing?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(T,{key:0},{default:(0,s.k6)(()=>[(0,s.bF)(W)]),_:1})),(0,s.eW)(" "+(0,n.v_)(_.reviewing?"评审中...":"开始需求评审"),1)]),_:1},8,["loading","onClick","disabled"])]),_.reviewResult?((0,s.uX)(),(0,s.CE)("div",p,[(0,s.Lk)("div",v,[t[14]||(t[14]=(0,s.Lk)("h3",null,"需求评审报告",-1)),(0,s.Lk)("div",m,[(0,s.bF)(M,{type:"success",onClick:x.downloadResult,disabled:!_.downloadUrl},{default:(0,s.k6)(()=>[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(V)]),_:1}),t[12]||(t[12]=(0,s.eW)(" 下载报告 ",-1))]),_:1,__:[12]},8,["onClick","disabled"]),(0,s.bF)(M,{onClick:x.copyToClipboard},{default:(0,s.k6)(()=>[(0,s.bF)(T,null,{default:(0,s.k6)(()=>[(0,s.bF)(D)]),_:1}),t[13]||(t[13]=(0,s.eW)(" 复制内容 ",-1))]),_:1,__:[13]},8,["onClick"])])]),(0,s.Lk)("div",g,[(0,s.Lk)("div",w,[t[15]||(t[15]=(0,s.Lk)("h4",null,"评审摘要",-1)),(0,s.Lk)("div",k,[(0,s.bF)(E,{type:x.getScoreType(_.reviewResult.score),size:"large"},{default:(0,s.k6)(()=>[(0,s.eW)(" 综合评分: "+(0,n.v_)(_.reviewResult.score)+"/100 ",1)]),_:1},8,["type"]),(0,s.bF)(E,{type:x.getIssueTagType(_.reviewResult.issueCount),size:"large"},{default:(0,s.k6)(()=>[(0,s.eW)(" 发现问题: "+(0,n.v_)(_.reviewResult.issueCount)+"个 ",1)]),_:1},8,["type"])])]),(0,s.Lk)("div",h,[t[16]||(t[16]=(0,s.Lk)("h4",null,"详细评审内容",-1)),(0,s.Lk)("div",{class:"review-content-text",innerHTML:x.formatReviewContent(_.reviewResult.content)},null,8,f)]),_.reviewResult.suggestions?((0,s.uX)(),(0,s.CE)("div",b,[t[17]||(t[17]=(0,s.Lk)("h4",null,"改进建议",-1)),(0,s.Lk)("div",{class:"suggestions-content",innerHTML:x.formatSuggestions(_.reviewResult.suggestions)},null,8,F)])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0)])]),_:1})])}var _=l(4335),x=l(163),L=l(8548),C={name:"RequirementReview",components:{UploadFilled:L.UploadFilled,Magic:L.Magic,Download:L.Download,DocumentCopy:L.DocumentCopy},data(){return{selectedApi:"cybotstar",uploadedFiles:[],fileList:[],fileContents:[],activeFileNames:[],textInput:"",reviewing:!1,reviewResult:null,downloadUrl:""}},methods:{handleFileChange(e){const t=e.size/1024/1024<10;if(!t)return x.nk.error("文件大小不能超过 10MB!"),!1;const l=[".txt",".md",".docx",".doc",".pdf",".xlsx",".xls",".json",".xml",".csv"],s=e.name.toLowerCase(),n=l.some(e=>s.endsWith(e));if(!n)return x.nk.error("不支持的文件格式！"),!1;this.uploadedFiles.push(e.raw);const a=new FileReader;a.onload=t=>{const l={fileName:e.name,content:t.target.result};this.fileContents.push(l),this.activeFileNames.includes(e.name)||this.activeFileNames.push(e.name)},a.readAsText(e.raw),x.nk.success("文件上传成功！")},handleFileRemove(e){const t=this.uploadedFiles.findIndex(t=>t.name===e.name);t>-1&&this.uploadedFiles.splice(t,1);const l=this.fileContents.findIndex(t=>t.fileName===e.name);l>-1&&this.fileContents.splice(l,1);const s=this.activeFileNames.indexOf(e.name);s>-1&&this.activeFileNames.splice(s,1)},async startReview(){if(0!==this.uploadedFiles.length||this.textInput.trim()){this.reviewing=!0;try{const e=new FormData;this.uploadedFiles.forEach(t=>{e.append("files",t)}),this.textInput.trim()&&e.append("content",this.textInput.trim()),e.append("apiProvider",this.selectedApi),e.append("reviewType","requirement");const t=await _.A.post("/api/review/requirement",e,{headers:{"Content-Type":"multipart/form-data"}});if(!t.data.success)throw new Error(t.data.error||"评审失败");this.reviewResult=t.data.result,this.downloadUrl=t.data.downloadUrl,x.nk.success("需求评审完成！")}catch(e){console.error("评审失败:",e);const t=e.response?.data?.error||e.message||"需求评审失败，请稍后重试";x.nk.error(t),this.reviewResult=null,this.downloadUrl=""}finally{this.reviewing=!1}}else x.nk.warning("请上传需求文档或输入需求内容")},async downloadResult(){if(this.downloadUrl)try{const e=await _.A.get(this.downloadUrl,{responseType:"blob"}),t=new Blob([e.data],{type:"application/octet-stream"}),l=window.URL.createObjectURL(t),s=document.createElement("a");s.href=l,s.download=`requirement-review-${(new Date).getTime()}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(l),x.nk.success("文件下载成功！")}catch(e){console.error("下载失败:",e),x.nk.error("文件下载失败")}else x.nk.warning("暂无可下载的文件")},async copyToClipboard(){if(this.reviewResult)try{const e=this.reviewResult.content+"\n\n"+(this.reviewResult.suggestions||"");await navigator.clipboard.writeText(e),x.nk.success("评审报告已复制到剪贴板")}catch(e){x.nk.error("复制失败，请手动复制")}},getScoreType(e){return e>=90?"success":e>=70?"warning":"danger"},getIssueTagType(e){return 0===e?"success":e<=3?"warning":"danger"},formatReviewContent(e){return e?e.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"):""},formatSuggestions(e){return e?e.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"):""}}},R=l(6262);const T=(0,R.A)(C,[["render",y],["__scopeId","data-v-5ff045d8"]]);var I=T}}]);
//# sourceMappingURL=979.eb7a5caf.js.map