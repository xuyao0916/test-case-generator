"use strict";(self["webpackChunktest_case_generator_client"]=self["webpackChunktest_case_generator_client"]||[]).push([[47],{7047:function(e,s,t){t.r(s),t.d(s,{default:function(){return M}});var n=t(641),a=t(33);const c={class:"wss-test-container"},o={class:"card-header"},r={key:0,class:"batch-status"},l={key:1,class:"batch-summary"},i={class:"interface-list"},u={class:"interface-header"},g={class:"interface-info"},d={class:"interface-actions"},m={class:"interface-content"},h={class:"config-info"},f={class:"url-info"},k={class:"params-info"},w={key:0,class:"messages-section"},b={class:"messages-container"},p={class:"message-header"},y={class:"message-type"},v={class:"message-time"},C={class:"message-content"},T={key:0,class:"message-note"};function _(e,s,t,_,F,I){const R=(0,n.g2)("el-button"),L=(0,n.g2)("el-progress"),M=(0,n.g2)("el-tag"),E=(0,n.g2)("el-card"),S=(0,n.g2)("el-input"),W=(0,n.g2)("el-form-item"),$=(0,n.g2)("el-form");return(0,n.uX)(),(0,n.CE)("div",c,[(0,n.bF)(E,{class:"header-card"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",o,[s[3]||(s[3]=(0,n.Lk)("span",null,"WSS接口测试",-1)),(0,n.bF)(R,{type:"primary",loading:F.batchTesting,onClick:I.testAllInterfaces,disabled:0===F.wssConfigs.length},{default:(0,n.k6)(()=>[(0,n.eW)((0,a.v_)(F.batchTesting?"测试中...":"测试所有接口"),1)]),_:1},8,["loading","onClick","disabled"])])]),default:(0,n.k6)(()=>[F.batchTesting||F.batchTestResults.length>0?((0,n.uX)(),(0,n.CE)("div",r,[F.batchTesting?((0,n.uX)(),(0,n.Wv)(L,{key:0,percentage:F.batchProgress,format:I.formatProgress},null,8,["percentage","format"])):(0,n.Q3)("",!0),F.batchTestResults.length>0?((0,n.uX)(),(0,n.CE)("div",l,[(0,n.bF)(M,{type:"success"},{default:(0,n.k6)(()=>[(0,n.eW)("成功: "+(0,a.v_)(F.batchTestResults.filter(e=>e.success).length),1)]),_:1}),(0,n.bF)(M,{type:"danger"},{default:(0,n.k6)(()=>[(0,n.eW)("失败: "+(0,a.v_)(F.batchTestResults.filter(e=>!e.success).length),1)]),_:1}),(0,n.bF)(M,{type:"info"},{default:(0,n.k6)(()=>[(0,n.eW)("总计: "+(0,a.v_)(F.batchTestResults.length),1)]),_:1})])):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0)]),_:1}),(0,n.Lk)("div",i,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(F.wssConfigs,(e,t)=>((0,n.uX)(),(0,n.Wv)(E,{key:t,class:(0,a.C4)(["interface-card",{testing:e.testing,connected:e.connected}])},{header:(0,n.k6)(()=>[(0,n.Lk)("div",u,[(0,n.Lk)("div",g,[(0,n.Lk)("h3",null,(0,a.v_)(e.name),1),(0,n.bF)(M,{type:I.getStatusType(e.status),size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,a.v_)(e.status),1)]),_:2},1032,["type"])]),(0,n.Lk)("div",d,[(0,n.bF)(R,{size:"small",type:e.connected?"danger":"primary",loading:e.connecting,onClick:e=>I.toggleConnection(t)},{default:(0,n.k6)(()=>[(0,n.eW)((0,a.v_)(e.connected?"断开":"连接"),1)]),_:2},1032,["type","loading","onClick"]),(0,n.bF)(R,{size:"small",type:"success",loading:e.testing,disabled:!e.connected,onClick:e=>I.testSingleInterface(t)},{default:(0,n.k6)(()=>[(0,n.eW)((0,a.v_)(e.testing?"测试中":"测试"),1)]),_:2},1032,["loading","disabled","onClick"])])])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",m,[(0,n.Lk)("div",h,[(0,n.Lk)("div",f,[s[4]||(s[4]=(0,n.Lk)("strong",null,"连接地址:",-1)),(0,n.eW)(" "+(0,a.v_)(e.url),1)]),(0,n.Lk)("div",k,[s[5]||(s[5]=(0,n.Lk)("strong",null,"测试参数:",-1)),(0,n.Lk)("pre",null,(0,a.v_)(JSON.stringify(e.testParams,null,2)),1)])]),e.messages&&e.messages.length>0?((0,n.uX)(),(0,n.CE)("div",w,[(0,n.Lk)("h4",null,"消息记录 ("+(0,a.v_)(e.messages.length)+")",1),(0,n.Lk)("div",b,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.messages,(e,s)=>((0,n.uX)(),(0,n.CE)("div",{key:s,class:(0,a.C4)(["message-item",e.type])},[(0,n.Lk)("div",p,[(0,n.Lk)("span",y,(0,a.v_)(I.getMessageTypeText(e.type)),1),(0,n.Lk)("span",v,(0,a.v_)(I.formatTime(e.timestamp)),1),e.testResult?((0,n.uX)(),(0,n.Wv)(M,{key:0,type:e.testResult.success?"success":"danger",size:"small"},{default:(0,n.k6)(()=>[(0,n.eW)((0,a.v_)(e.testResult.success?"成功":"失败"),1)]),_:2},1032,["type"])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",C,(0,a.v_)(e.content),1),e.testResult&&e.testResult.note?((0,n.uX)(),(0,n.CE)("div",T,(0,a.v_)(e.testResult.note),1)):(0,n.Q3)("",!0)],2))),128))])])):(0,n.Q3)("",!0)])]),_:2},1032,["class"]))),128))]),(0,n.bF)(E,{class:"add-interface-card"},{header:(0,n.k6)(()=>s[6]||(s[6]=[(0,n.Lk)("span",null,"添加新的WSS接口",-1)])),default:(0,n.k6)(()=>[(0,n.bF)($,{model:F.newInterfaceForm,"label-width":"120px"},{default:(0,n.k6)(()=>[(0,n.bF)(W,{label:"接口名称"},{default:(0,n.k6)(()=>[(0,n.bF)(S,{modelValue:F.newInterfaceForm.name,"onUpdate:modelValue":s[0]||(s[0]=e=>F.newInterfaceForm.name=e),placeholder:"请输入接口名称"},null,8,["modelValue"])]),_:1}),(0,n.bF)(W,{label:"WSS地址"},{default:(0,n.k6)(()=>[(0,n.bF)(S,{modelValue:F.newInterfaceForm.url,"onUpdate:modelValue":s[1]||(s[1]=e=>F.newInterfaceForm.url=e),placeholder:"wss://example.com/ws"},null,8,["modelValue"])]),_:1}),(0,n.bF)(W,{label:"测试参数"},{default:(0,n.k6)(()=>[(0,n.bF)(S,{modelValue:F.newInterfaceForm.params,"onUpdate:modelValue":s[2]||(s[2]=e=>F.newInterfaceForm.params=e),type:"textarea",rows:6,placeholder:'{"key": "value"}'},null,8,["modelValue"])]),_:1}),(0,n.bF)(W,null,{default:(0,n.k6)(()=>[(0,n.bF)(R,{type:"primary",onClick:I.addNewInterface},{default:(0,n.k6)(()=>s[7]||(s[7]=[(0,n.eW)("添加接口",-1)])),_:1,__:[7]},8,["onClick"]),(0,n.bF)(R,{onClick:I.resetForm},{default:(0,n.k6)(()=>s[8]||(s[8]=[(0,n.eW)("重置",-1)])),_:1,__:[8]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1})])}var F=t(163),I={name:"WssTest",data(){return{batchTesting:!1,batchProgress:0,batchTestResults:[],wssConfigs:[{name:"CybotStar多轮对话测试",url:"wss://www.cybotstar.cn/openapi/v2/ws/dialog/",testParams:{"cybertron-robot-token":"MTc1MjE1NTEzMjU1Nwp0ejl3K1ZYY2F2MkZrUkVHTGsyRGZhZUltOEU9","cybertron-robot-key":"s%2B6v1Kd9jdVoa79rHsgOLKTy0qE%3D",username:"yao.xu@brgroup.com",question:"你帮我写一个10句诗词"},connected:!1,connecting:!1,testing:!1,status:"未连接",websocket:null,messages:[]},{name:"轻量接口",url:"wss://www.cybotstar.cn/openapi/ws/lightweight/dialog/",testParams:{"cybertron-robot-token":"MTc1MjE1NTEzMjU1Nwp0ejl3K1ZYY2F2MkZrUkVHTGsyRGZhZUltOEU9","cybertron-robot-key":"s%2B6v1Kd9jdVoa79rHsgOLKTy0qE%3D",username:"yao.xu@brgroup.com",question:"你帮我写一个10句诗词"},connected:!1,connecting:!1,testing:!1,status:"未连接",websocket:null,messages:[]},{name:"bate接口",url:"wss://www.cybotstar.cn/openapi/ws/agent-dialog/lightweight-beta/dialog/",testParams:{"cybertron-robot-token":"MTc1MjE1NTEzMjU1Nwp0ejl3K1ZYY2F2MkZrUkVHTGsyRGZhZUltOEU9","cybertron-robot-key":"s%2B6v1Kd9jdVoa79rHsgOLKTy0qE%3D",username:"yao.xu@brgroup.com",question:"你帮我写一个10句诗词"},connected:!1,connecting:!1,testing:!1,status:"未连接",websocket:null,messages:[]}],newInterfaceForm:{name:"",url:"",params:""}}},methods:{async testAllInterfaces(){if(0!==this.wssConfigs.length){this.batchTesting=!0,this.batchProgress=0,this.batchTestResults=[];try{for(let s=0;s<this.wssConfigs.length;s++){const t=this.wssConfigs[s];this.batchProgress=Math.round(s/this.wssConfigs.length*100);try{t.connected||(await this.connectInterface(s),await this.sleep(1e3)),t.connected?(await this.testSingleInterface(s),this.batchTestResults.push({name:t.name,success:!0,message:"测试完成"})):this.batchTestResults.push({name:t.name,success:!1,message:"连接失败"})}catch(e){this.batchTestResults.push({name:t.name,success:!1,message:e.message})}await this.sleep(500)}this.batchProgress=100,F.nk.success(`批量测试完成！成功: ${this.batchTestResults.filter(e=>e.success).length}, 失败: ${this.batchTestResults.filter(e=>!e.success).length}`),await this.disconnectAllInterfaces()}catch(e){F.nk.error(`批量测试失败: ${e.message}`)}finally{this.batchTesting=!1}}else F.nk.warning("没有可测试的接口")},async toggleConnection(e){const s=this.wssConfigs[e];s.connected?this.disconnectInterface(e):await this.connectInterface(e)},async connectInterface(e){const s=this.wssConfigs[e];if(!s.connecting&&!s.connected){s.connecting=!0,s.status="连接中...";try{const t=new WebSocket(s.url);return new Promise((n,a)=>{const c=setTimeout(()=>{t.close(),a(new Error("连接超时"))},1e4);t.onopen=()=>{clearTimeout(c),s.connected=!0,s.connecting=!1,s.status="已连接",s.websocket=t,this.addMessage(e,{type:"system",content:"WebSocket连接成功",timestamp:new Date,testResult:{success:!0,note:"连接建立成功"}}),F.nk.success(`${s.name} 连接成功`),n()},t.onmessage=s=>{this.addMessage(e,{type:"received",content:s.data,timestamp:new Date,testResult:{success:!0,note:"接收消息成功"}})},t.onerror=t=>{clearTimeout(c),s.connecting=!1,s.status="连接失败",this.addMessage(e,{type:"error",content:`连接错误: ${t.message||"未知错误"}`,timestamp:new Date,testResult:{success:!1,note:"连接建立失败"}}),a(t)},t.onclose=t=>{clearTimeout(c),s.connected=!1,s.connecting=!1,s.status="已断开",s.websocket=null,this.addMessage(e,{type:"system",content:`连接关闭 (代码: ${t.code})`,timestamp:new Date,testResult:{success:1e3===t.code,note:1e3===t.code?"正常关闭连接":"异常关闭连接"}})}})}catch(t){throw s.connecting=!1,s.status="连接失败",F.nk.error(`${s.name} 连接失败: ${t.message}`),this.addMessage(e,{type:"error",content:`连接失败: ${t.message}`,timestamp:new Date,testResult:{success:!1,note:"连接建立失败"}}),t}}},disconnectInterface(e){const s=this.wssConfigs[e];s.websocket&&(s.websocket.close(),s.websocket=null),s.connected=!1,s.status="已断开",F.nk.info(`${s.name} 已断开连接`)},async disconnectAllInterfaces(){let e=0;for(let s=0;s<this.wssConfigs.length;s++){const t=this.wssConfigs[s];t.connected&&(this.disconnectInterface(s),e++,await this.sleep(200))}e>0&&F.nk.info(`已断开 ${e} 个WSS连接`)},async testSingleInterface(e){const s=this.wssConfigs[e];if(s.connected&&s.websocket){s.testing=!0;try{const t=JSON.stringify(s.testParams);s.websocket.send(t),this.addMessage(e,{type:"sent",content:t,timestamp:new Date,testResult:{success:!0,note:"消息发送成功"}}),F.nk.success(`${s.name} 测试消息发送成功`),await this.sleep(2e3)}catch(t){throw F.nk.error(`${s.name} 测试失败: ${t.message}`),this.addMessage(e,{type:"error",content:`测试失败: ${t.message}`,timestamp:new Date,testResult:{success:!1,note:"消息发送失败"}}),t}finally{s.testing=!1}}else F.nk.warning("请先连接接口")},addMessage(e,s){this.wssConfigs[e].messages||this.$set(this.wssConfigs[e],"messages",[]),this.wssConfigs[e].messages.unshift(s),this.wssConfigs[e].messages.length>100&&(this.wssConfigs[e].messages=this.wssConfigs[e].messages.slice(0,100))},addNewInterface(){if(!this.newInterfaceForm.name||!this.newInterfaceForm.url)return void F.nk.warning("请填写接口名称和地址");let e={};if(this.newInterfaceForm.params)try{e=JSON.parse(this.newInterfaceForm.params)}catch(s){return void F.nk.error("测试参数格式错误，请输入有效的JSON")}this.wssConfigs.push({name:this.newInterfaceForm.name,url:this.newInterfaceForm.url,testParams:e,connected:!1,connecting:!1,testing:!1,status:"未连接",websocket:null,messages:[]}),F.nk.success("接口添加成功"),this.resetForm()},resetForm(){this.newInterfaceForm={name:"",url:"",params:""}},sleep(e){return new Promise(s=>setTimeout(s,e))},getStatusType(e){const s={"未连接":"info","连接中...":"warning","已连接":"success","连接失败":"danger","已断开":"info"};return s[e]||"info"},getMessageTypeText(e){const s={sent:"发送",received:"接收",error:"错误",system:"系统"};return s[e]||e},formatTime(e){return new Date(e).toLocaleTimeString()},formatProgress(e){return`${e}%`}},beforeUnmount(){this.wssConfigs.forEach((e,s)=>{e.connected&&this.disconnectInterface(s)})}},R=t(6262);const L=(0,R.A)(I,[["render",_],["__scopeId","data-v-04ad7677"]]);var M=L}}]);
//# sourceMappingURL=47.220dbcd7.js.map